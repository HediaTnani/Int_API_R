<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hedia Tnani">

<title>Intermediate API in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Int_API_R_files/libs/clipboard/clipboard.min.js"></script>
<script src="Int_API_R_files/libs/quarto-html/quarto.js"></script>
<script src="Int_API_R_files/libs/quarto-html/popper.min.js"></script>
<script src="Int_API_R_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Int_API_R_files/libs/quarto-html/anchor.min.js"></script>
<link href="Int_API_R_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Int_API_R_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Int_API_R_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Int_API_R_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Int_API_R_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Intermediate API in R</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hedia Tnani </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="intermediate-api-in-r" class="level1">
<h1>Intermediate API in R</h1>
<section id="basic-api-in-r" class="level2">
<h2 class="anchored" data-anchor-id="basic-api-in-r">1. Basic API in R</h2>
<p>Lat time we saw how to make a <code>GET</code> request to retrieve data from an API. We’ll remember again the different steps. We’ll also add query parameters and authentication.</p>
<p>Let’s remember what we did last time using the Ensembl Rest API.</p>
<p>First we prepare the URL.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr) <span class="co"># accessing APIs</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Preparing the URL </span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>baseURL <span class="ot">&lt;-</span> <span class="st">"https://rest.ensembl.org"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>ext <span class="ot">&lt;-</span> <span class="st">"/regulatory/species/homo_sapiens/microarray?"</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>URL <span class="ot">&lt;-</span> <span class="fu">modify_url</span>(baseURL, <span class="at">path =</span> ext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we saw last time a <strong>Uniform Resource Identifier (URI)</strong> <strong>resource</strong> specifies which resource you want to access. A URI is a generalization of a URL (Uniform Resource Locator)—what you commonly think of as "web addresses".</p>
<p>Then we query the database.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>response <span class="ot">=</span> <span class="fu">GET</span>(URL)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>response</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Response [https://rest.ensembl.org/regulatory/species/homo_sapiens/microarray]
  Date: 2023-03-16 14:32
  Status: 200
  Content-Type: application/json
  Size: 3.46 kB</code></pre>
</div>
</div>
<p>Then we convert the JSON format to a dataframe by using the <code>fromJSON</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fromJSON</span>(<span class="fu">content</span>(response,<span class="at">as =</span> <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span> ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    type   vendor      format                   description
1  OLIGO  PHALANX  EXPRESSION                          &lt;NA&gt;
2  OLIGO CODELINK  EXPRESSION                          &lt;NA&gt;
3  OLIGO ILLUMINA  EXPRESSION                          &lt;NA&gt;
4  OLIGO  AGILENT  EXPRESSION                          &lt;NA&gt;
5  OLIGO ILLUMINA METHYLATION                          &lt;NA&gt;
6  OLIGO ILLUMINA  EXPRESSION                          &lt;NA&gt;
7  OLIGO  AGILENT  EXPRESSION                          &lt;NA&gt;
8  OLIGO  AGILENT         CGH                          &lt;NA&gt;
9  OLIGO  AGILENT  EXPRESSION                          &lt;NA&gt;
10 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
11 OLIGO  AGILENT  EXPRESSION                          &lt;NA&gt;
12 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
13 OLIGO  AGILENT  EXPRESSION                          &lt;NA&gt;
14 OLIGO  AGILENT  EXPRESSION                          &lt;NA&gt;
15 OLIGO  AGILENT  EXPRESSION                          &lt;NA&gt;
16 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
17 OLIGO  AGILENT  EXPRESSION                          &lt;NA&gt;
18 OLIGO ILLUMINA METHYLATION                          &lt;NA&gt;
19 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
20 OLIGO     AFFY  EXPRESSION Human Transcriptome Array 2.0
21 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
22 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
23 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
24 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
25 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
26 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
27 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
28 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
29 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
30 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
31 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
32 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
33 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
34 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
35 OLIGO     AFFY  EXPRESSION                          &lt;NA&gt;
                      array
1                  OneArray
2                  CODELINK
3              HumanWG_6_V3
4                   GPL6848
5       HumanMethylation450
6             HumanRef-8_V3
7               WholeGenome
8                   CGH_44b
9     SurePrint_G3_GE_8x60k
10                  HC-G110
11 SurePrint_G3_GE_8x60k_v2
12                 HG-Focus
13     WholeGenome_4x44k_v1
14     WholeGenome_4x44k_v2
15                 GPL26966
16               HG-U133A_2
17                 GPL19072
18       HumanMethylation27
19                 HG-U133B
20                  HTA-2_0
21           HG-U133_Plus_2
22                HG_U95Av2
23                  HG-U95B
24                  HG-U95C
25                  HG-U95D
26                  HG-U95E
27                  HG_U95A
28                 HuGeneFL
29                 U133_X3P
30                PrimeView
31       HT_HG-U133_Plus_PM
32           HuEx-1_0-st-v2
33         HuGene-2_0-st-v1
34         HuGene-1_0-st-v1
35         HuGene-2_1-st-v1</code></pre>
</div>
</div>
<p>Then we saw how to make a function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>get_microarrays <span class="ot">&lt;-</span> <span class="cf">function</span>(baseURL, ext, content_type){</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="fu">paste</span>(baseURL, ext, <span class="at">sep =</span> <span class="st">""</span>), <span class="fu">accept</span>(content_type))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop_for_status</span>(r)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (content_type <span class="sc">==</span> <span class="st">'application/json'</span>){</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> (<span class="fu">fromJSON</span>(<span class="fu">content</span>(r, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)))</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> (<span class="fu">content</span>(r, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>baseURL <span class="ot">&lt;-</span> <span class="st">"https://rest.ensembl.org"</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>ext <span class="ot">&lt;-</span> <span class="st">"/regulatory/species/homo_sapiens/microarray?"</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="st">"application/json"</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="fu">get_microarrays</span>(baseURL, ext, con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     description  type      format   vendor
1                           &lt;NA&gt; OLIGO  EXPRESSION  PHALANX
2                           &lt;NA&gt; OLIGO  EXPRESSION CODELINK
3                           &lt;NA&gt; OLIGO  EXPRESSION ILLUMINA
4                           &lt;NA&gt; OLIGO  EXPRESSION  AGILENT
5                           &lt;NA&gt; OLIGO METHYLATION ILLUMINA
6                           &lt;NA&gt; OLIGO  EXPRESSION ILLUMINA
7                           &lt;NA&gt; OLIGO  EXPRESSION  AGILENT
8                           &lt;NA&gt; OLIGO         CGH  AGILENT
9                           &lt;NA&gt; OLIGO  EXPRESSION  AGILENT
10                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
11                          &lt;NA&gt; OLIGO  EXPRESSION  AGILENT
12                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
13                          &lt;NA&gt; OLIGO  EXPRESSION  AGILENT
14                          &lt;NA&gt; OLIGO  EXPRESSION  AGILENT
15                          &lt;NA&gt; OLIGO  EXPRESSION  AGILENT
16                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
17                          &lt;NA&gt; OLIGO  EXPRESSION  AGILENT
18                          &lt;NA&gt; OLIGO METHYLATION ILLUMINA
19                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
20 Human Transcriptome Array 2.0 OLIGO  EXPRESSION     AFFY
21                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
22                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
23                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
24                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
25                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
26                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
27                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
28                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
29                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
30                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
31                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
32                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
33                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
34                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
35                          &lt;NA&gt; OLIGO  EXPRESSION     AFFY
                      array
1                  OneArray
2                  CODELINK
3              HumanWG_6_V3
4                   GPL6848
5       HumanMethylation450
6             HumanRef-8_V3
7               WholeGenome
8                   CGH_44b
9     SurePrint_G3_GE_8x60k
10                  HC-G110
11 SurePrint_G3_GE_8x60k_v2
12                 HG-Focus
13     WholeGenome_4x44k_v1
14     WholeGenome_4x44k_v2
15                 GPL26966
16               HG-U133A_2
17                 GPL19072
18       HumanMethylation27
19                 HG-U133B
20                  HTA-2_0
21           HG-U133_Plus_2
22                HG_U95Av2
23                  HG-U95B
24                  HG-U95C
25                  HG-U95D
26                  HG-U95E
27                  HG_U95A
28                 HuGeneFL
29                 U133_X3P
30                PrimeView
31       HT_HG-U133_Plus_PM
32           HuEx-1_0-st-v2
33         HuGene-2_0-st-v1
34         HuGene-1_0-st-v1
35         HuGene-2_1-st-v1</code></pre>
</div>
</div>
</section>
<section id="intermediate-api-in-r-1" class="level2">
<h2 class="anchored" data-anchor-id="intermediate-api-in-r-1">2. Intermediate API in R</h2>
<section id="adding-query-parameters" class="level3">
<h3 class="anchored" data-anchor-id="adding-query-parameters"><strong>2.1. Adding Query Parameters</strong></h3>
<p>What if we need to add query parameters ?</p>
<p>Query parameters are the extra <strong>parameters</strong> (arguments) about what resource to access.</p>
<p>We can pass <code>query</code> parameters as a named list, where the names are the <code>API</code> fields for each query parameter.</p>
<p>We can use the <code>query</code> parameter of the <strong><code>GET()</code> function</strong> from the <code>httr</code> package to add the query parameters to our request.</p>
<p>So let’s edit the previous <code>get_microarrays()</code> function.</p>
<ul>
<li><p>Add a <strong>new parameter</strong> named <code>queries</code> to the function and assign <code>list()</code> to it to make it an optional parameter: <code>queries = list()</code>. We assign a <code>list()</code> here so that multiple optional parameters can be passed to our function.</p></li>
<li><p>Edit the <code>GET()</code> function to set its <code>query</code> parameter to our function parameter <code>queries</code>.</p></li>
</ul>
<p>Let’s take again the same example using the Ensembl rest API.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>get_microarrays <span class="ot">&lt;-</span> <span class="cf">function</span>(baseURL, endpoint, queries){</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    r <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="fu">paste</span>(baseURL, endpoint, <span class="at">sep =</span> <span class="st">""</span>), queries)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop_for_status</span>(r)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span> (<span class="fu">content</span>(r, <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>baseURL <span class="ot">&lt;-</span> <span class="st">"https://rest.ensembl.org"</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>endpoint <span class="ot">&lt;-</span> <span class="st">"/regulatory/species/homo_sapiens/microarray?"</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>queries <span class="ot">=</span> <span class="fu">list</span>(<span class="at">format=</span><span class="st">"json"</span>)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="fu">get_microarrays</span>(baseURL, endpoint, queries)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "[{\"vendor\":\"PHALANX\",\"description\":null,\"array\":\"OneArray\",\"format\":\"EXPRESSION\",\"type\":\"OLIGO\"},{\"type\":\"OLIGO\",\"array\":\"CODELINK\",\"format\":\"EXPRESSION\",\"description\":null,\"vendor\":\"CODELINK\"},{\"vendor\":\"ILLUMINA\",\"description\":null,\"type\":\"OLIGO\",\"array\":\"HumanWG_6_V3\",\"format\":\"EXPRESSION\"},{\"array\":\"GPL6848\",\"format\":\"EXPRESSION\",\"type\":\"OLIGO\",\"description\":null,\"vendor\":\"AGILENT\"},{\"format\":\"METHYLATION\",\"array\":\"HumanMethylation450\",\"type\":\"OLIGO\",\"description\":null,\"vendor\":\"ILLUMINA\"},{\"description\":null,\"vendor\":\"ILLUMINA\",\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"HumanRef-8_V3\"},{\"description\":null,\"vendor\":\"AGILENT\",\"type\":\"OLIGO\",\"array\":\"WholeGenome\",\"format\":\"EXPRESSION\"},{\"type\":\"OLIGO\",\"format\":\"CGH\",\"array\":\"CGH_44b\",\"vendor\":\"AGILENT\",\"description\":null},{\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"SurePrint_G3_GE_8x60k\",\"vendor\":\"AGILENT\",\"description\":null},{\"vendor\":\"AFFY\",\"description\":null,\"format\":\"EXPRESSION\",\"array\":\"HC-G110\",\"type\":\"OLIGO\"},{\"description\":null,\"vendor\":\"AGILENT\",\"array\":\"SurePrint_G3_GE_8x60k_v2\",\"format\":\"EXPRESSION\",\"type\":\"OLIGO\"},{\"format\":\"EXPRESSION\",\"array\":\"HG-Focus\",\"type\":\"OLIGO\",\"description\":null,\"vendor\":\"AFFY\"},{\"description\":null,\"vendor\":\"AGILENT\",\"format\":\"EXPRESSION\",\"array\":\"WholeGenome_4x44k_v1\",\"type\":\"OLIGO\"},{\"format\":\"EXPRESSION\",\"array\":\"WholeGenome_4x44k_v2\",\"type\":\"OLIGO\",\"description\":null,\"vendor\":\"AGILENT\"},{\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"GPL26966\",\"vendor\":\"AGILENT\",\"description\":null},{\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"HG-U133A_2\",\"description\":null,\"vendor\":\"AFFY\"},{\"vendor\":\"AGILENT\",\"description\":null,\"format\":\"EXPRESSION\",\"array\":\"GPL19072\",\"type\":\"OLIGO\"},{\"description\":null,\"vendor\":\"ILLUMINA\",\"type\":\"OLIGO\",\"format\":\"METHYLATION\",\"array\":\"HumanMethylation27\"},{\"description\":null,\"vendor\":\"AFFY\",\"array\":\"HG-U133B\",\"format\":\"EXPRESSION\",\"type\":\"OLIGO\"},{\"description\":\"Human Transcriptome Array 2.0\",\"vendor\":\"AFFY\",\"array\":\"HTA-2_0\",\"format\":\"EXPRESSION\",\"type\":\"OLIGO\"},{\"description\":null,\"vendor\":\"AFFY\",\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"HG-U133_Plus_2\"},{\"format\":\"EXPRESSION\",\"array\":\"HG_U95Av2\",\"type\":\"OLIGO\",\"description\":null,\"vendor\":\"AFFY\"},{\"description\":null,\"vendor\":\"AFFY\",\"format\":\"EXPRESSION\",\"array\":\"HG-U95B\",\"type\":\"OLIGO\"},{\"description\":null,\"vendor\":\"AFFY\",\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"HG-U95C\"},{\"description\":null,\"vendor\":\"AFFY\",\"format\":\"EXPRESSION\",\"array\":\"HG-U95D\",\"type\":\"OLIGO\"},{\"vendor\":\"AFFY\",\"description\":null,\"format\":\"EXPRESSION\",\"array\":\"HG-U95E\",\"type\":\"OLIGO\"},{\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"HG_U95A\",\"description\":null,\"vendor\":\"AFFY\"},{\"vendor\":\"AFFY\",\"description\":null,\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"HuGeneFL\"},{\"type\":\"OLIGO\",\"array\":\"U133_X3P\",\"format\":\"EXPRESSION\",\"description\":null,\"vendor\":\"AFFY\"},{\"vendor\":\"AFFY\",\"description\":null,\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"PrimeView\"},{\"type\":\"OLIGO\",\"array\":\"HT_HG-U133_Plus_PM\",\"format\":\"EXPRESSION\",\"description\":null,\"vendor\":\"AFFY\"},{\"vendor\":\"AFFY\",\"description\":null,\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"HuEx-1_0-st-v2\"},{\"description\":null,\"vendor\":\"AFFY\",\"array\":\"HuGene-2_0-st-v1\",\"format\":\"EXPRESSION\",\"type\":\"OLIGO\"},{\"description\":null,\"vendor\":\"AFFY\",\"format\":\"EXPRESSION\",\"array\":\"HuGene-1_0-st-v1\",\"type\":\"OLIGO\"},{\"type\":\"OLIGO\",\"format\":\"EXPRESSION\",\"array\":\"HuGene-2_1-st-v1\",\"description\":null,\"vendor\":\"AFFY\"}]"</code></pre>
</div>
</div>
</section>
</section>
<section id="chatgpts-api-authentification" class="level2">
<h2 class="anchored" data-anchor-id="chatgpts-api-authentification">2.2 ChatGPT’s <strong>API Authentification</strong></h2>
<p>To authenticate with the ChatGPT’s API, we need to use an access token. An access token is a credential we can <strong>generate</strong> on the OpenAI’s website. The token is a string that the API can read and associate with our account.</p>
<p>Typically APIs use the following authentication types:</p>
<ul>
<li><strong>Username-password authentication</strong>: requires a username and password. We can use the <code>authenticate("username", "password")</code> function in the API requests to achieve this.</li>
</ul>
<p><strong>API key authentication</strong>: requires an API “key” or “token.” We can use the <code>api_key = "key"</code> parameter request to achieve this.</p>
<p>Access tokens can have scopes and specific permissions. Using read-access-only tokens in potentially insecure or shared scripts improves security.</p>
<p>APIs also use authentication for <strong>rate limiting</strong>. Developers typically use APIs to build interesting applications or services. Ensuring an API is available and responsive for all users will prevent us from making too many requests too quickly. We call this <strong>restriction rate limiting</strong>.</p>
<section id="create-openai-api-keys" class="level3">
<h3 class="anchored" data-anchor-id="create-openai-api-keys">2.2.1 Create OpenAI API Keys</h3>
<p>To use OpenAI through API, you must create a free account and generate keys.</p>
<p>1. Sign up here&nbsp;<a href="https://beta.openai.com/signup" alt="https://beta.openai.com/signup">https://beta.openai.com/signup</a>. You&nbsp;can use your Google or Microsoft account to sign up if you don’t want to create using an email/password combination. You may need a valid mobile number to verify your account.</p>
<p><br>
2. Now, visit your OpenAI key page&nbsp;<a href="https://beta.openai.com/account/api-keys" alt="https://beta.openai.com/account/api-keys">https://beta.openai.com/account/api-keys</a>&nbsp;or click the menu item “View API keys”</p>
<p><img src="images/OpenAI_1.png" class="img-fluid" width="400"></p>
<p>3. Create a new key by clicking on <strong>Personal</strong> and then “Create new secret key” button. See the image below for reference.</p>
<p><img src="images/OpenAI_2.png" class="img-fluid"></p>
<p>Et voila !!!</p>
<p>OpenAI gives $18 free credits which you can consume within the first 3 months.</p>
</section>
<section id="use-openai-api-keys" class="level3">
<h3 class="anchored" data-anchor-id="use-openai-api-keys">2.2.2 Use OpenAI API Keys</h3>
<p>Here we’ll explain the different ways that are usually used to set the API key up in RStudio :</p>
<ul>
<li>By default, API calls will look for <code>OPENAI_API_KEY</code> environment variable. If you want to set a global environment variable, you can use the following command, where <code>"&lt;APIKEY&gt;"</code> should be replaced with your actual key:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setenv</span>(<span class="at">OPENAI_API_KEY =</span> <span class="st">"&lt;OPENAI_API_KEY&gt;"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Alternatively, you can set the key in your <code>.Renviron</code> file.</li>
</ul>
<p>The following commands will open .Renviron for editing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(usethis)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">edit_r_environ</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can add the following line to the file (again, replace <code>&lt;my_api_key&gt;</code> with your actual key):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>OPENAI_API_KEY<span class="ot">=</span><span class="er">&lt;</span>my_api_key<span class="sc">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make sure your ‘.Renviron’ ends with a newline. Don't forget to save and restart R for this change to take effect. This now set the API key. This is a less secure approach.</p>
<ul>
<li><p>Use a more secure approach by using <code>ask_pass</code> that if possible uses <code>askpass::askpass()</code> to interactively safely prompt you for the values</p>
<p>For that we’ll be using this function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>set_api_key <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">key =</span> <span class="cn">NULL</span>) { </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(key)) { </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    key <span class="ot">&lt;-</span> askpass<span class="sc">::</span><span class="fu">askpass</span>(<span class="st">"Please enter your API key"</span>) } </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.setenv</span>(<span class="st">"OPENAI_KEY"</span> <span class="ot">=</span> key) }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
<p>httr2 provides <code>secret_encrypt()</code> and <code>secret_decrypt()</code> to scramble secrets so that you can include them in your public source code without worrying that others can read them. There are three basic steps to this process:</p>
<ol type="1">
<li><p>You create an <strong>encryption</strong> key with <code>secret_make_key()</code> that is used to scramble and descramble secrets using symmetric cryptography.</p></li>
<li><p>You scramble your secrets with <code>secret_encrypt()</code> and store the resulting text directly in the source code of your package.</p></li>
<li><p>When needed, you descramble the secret using <code>secret_decrypt().</code></p></li>
</ol>
</section>
</section>
<section id="hands-on-exercice-using-chatgpt-in-r" class="level2">
<h2 class="anchored" data-anchor-id="hands-on-exercice-using-chatgpt-in-r">Hands-on exercice using ChatGPT in R</h2>
<p>Let’s apply what we’ve learned so far.</p>
<p>Let’s set up our token.</p>
<p>First let’s run the <code>set_api_key( )</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>set_api_key <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">key =</span> <span class="cn">NULL</span>) { </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(key)) { </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    key <span class="ot">&lt;-</span> askpass<span class="sc">::</span><span class="fu">askpass</span>(<span class="st">"Please enter your OpenAI API key"</span>) } </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Sys.setenv</span>(<span class="st">"OPENAI_KEY"</span> <span class="ot">=</span> key) }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong><code>Sys.setenv</code></strong> sets environment variables. Then let’s call the function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set_api_key</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You’ll get a prompt asking for the token. For that, go to OpenAI and click on “Create new secret key”.</p>
<p><img src="images/OpenAI_3.png" class="img-fluid"></p>
<p>Copy the API key and paste it in the prompt.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"OPENAI_KEY"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">is.null</span>(key)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can pass our token to the OpenAI API through the query parameter <code>api_key</code>, just like we did before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">library</span>(httr) </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a> key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"OPENAI_KEY"</span>) </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a> headers <span class="ot">=</span> <span class="fu">c</span>( <span class="st">`</span><span class="at">Authorization</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">'Bearer'</span>, key), <span class="st">`</span><span class="at">Content-Type</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'application/json'</span> ) </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="at">url =</span> <span class="st">'https://api.openai.com/v1/models/text-davinci-003'</span>, httr<span class="sc">::</span><span class="fu">add_headers</span>(<span class="at">.headers=</span>headers)) </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a> res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As we saw last time the status code is a three digit number that summarises whether or not the request was successful.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">http_status</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>GPT-3.5</code> models can understand and generate natural language or code. <code>text-davinci-003</code> is Can do any language task with better quality, longer output, and consistent instruction-following than the curie, babbage, or ada models. Also supports inserting completions within text. For more information about the different models go to this <a href="https://platform.openai.com/docs/models/gpt-3-5">link</a>.</p>
<p>You can change the model. The most capable and cost effective model in the GPT-3.5 family is <strong><code>gpt-3.5-turbo</code></strong> which has been optimized for chat but works well for traditional completions tasks as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr) </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a> key <span class="ot">&lt;-</span> <span class="fu">Sys.getenv</span>(<span class="st">"OPENAI_KEY"</span>) </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a> headers <span class="ot">=</span> <span class="fu">c</span>( <span class="st">`</span><span class="at">Authorization</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">'Bearer'</span>, key), <span class="st">`</span><span class="at">Content-Type</span><span class="st">`</span> <span class="ot">=</span> <span class="st">'application/json'</span> ) </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">GET</span>(<span class="at">url =</span> <span class="st">'https://api.openai.com/v1/models/gpt-3.5-turbo'</span>, httr<span class="sc">::</span><span class="fu">add_headers</span>(<span class="at">.headers=</span>headers)) </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a> res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="post-requests" class="level3">
<h3 class="anchored" data-anchor-id="post-requests">POST requests</h3>
<p>We use <code>POST</code> requests to send information (instead of retrieving it) and create objects on the API’s server.</p>
<p>When <code>POST()</code>ing, you can include data in the <code>body</code> of the request. <code>httr</code> allows you to supply this in a number of different ways. The most common way is a named list. If the body is a named list you should specify how it will be encoded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># JSON encoded</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">POST</span>(url, <span class="at">body =</span> body, <span class="at">encode =</span> <span class="st">"json"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s say you want to optimize your R code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>code <span class="ot">=</span> <span class="st">"i &lt;- 10</span><span class="sc">\n</span><span class="st">while (i &gt; 0) {</span><span class="sc">\n</span><span class="st"> i &lt;- i - 1</span><span class="sc">\n</span><span class="st"> print(i)</span><span class="sc">\n</span><span class="st">}"</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(code,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In the prompt you have to ask</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>prompt <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">'Optimize the following R code: "'</span>, code, <span class="st">'"'</span>) </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>prompt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You have to give the body of the POST request.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="at">model =</span> <span class="st">"text-davinci-003"</span>, <span class="at">max_tokens =</span> <span class="dv">256</span>, <span class="at">temperature =</span><span class="fl">0.7</span>, <span class="at">top_p =</span> <span class="dv">1</span>, <span class="at">frequency_penalty =</span> <span class="dv">0</span>, <span class="at">presence_penalty =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s run our POST request</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">=</span> <span class="fu">content</span>(<span class="fu">POST</span>( <span class="st">"https://api.openai.com/v1/completions"</span>, <span class="fu">add_headers</span>(<span class="st">"Authorization"</span> <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">'Bearer'</span>, key)), <span class="fu">content_type_json</span>(), <span class="at">body =</span> <span class="fu">toJSON</span>(<span class="fu">c</span>(params, <span class="fu">list</span>(<span class="at">prompt =</span> prompt)), <span class="at">auto_unbox =</span> <span class="cn">TRUE</span>) ))</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(r<span class="sc">$</span>choices[[<span class="dv">1</span>]]<span class="sc">$</span>text,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="exercice" class="level2">
<h2 class="anchored" data-anchor-id="exercice">Exercice</h2>
<p>Use the example above to do the same task as above using <code>httr2</code> .</p>
<section id="chatgpt-r-packages" class="level3">
<h3 class="anchored" data-anchor-id="chatgpt-r-packages">ChatGPT R packages</h3>
<p>https://github.com/jcrodriguez1989/chatgpt</p>
<p>https://jameshwade.github.io/gpttools/</p>
<p>https://irudnyts.github.io/openai/</p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>https://info201.github.io/apis.html</p>
<p>https://observablehq.com/@periscopic/cozy-collecting-part-1</p>
<p>https://observablehq.com/@periscopic/cozy-collecting-part-2</p>
<p>https://observablehq.com/@periscopic/cozy-collecting-case-study</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>